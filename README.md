This repository contains the code for creating the WMAgent database.

# WMBS Database Schema

## Overview
WMBS (Workload Management Bookkeeping Service) provides the database schema for managing workloads and jobs.

## Database Schema Initialization

The WMBS database schema can be initialized using either MariaDB or Oracle backends. The schema files are organized as follows:

src/sql/
├── oracle/      # Oracle-specific SQL statements
└── mariadb/     # MariaDB-specific SQL statements

## Schema changes

For Oracle, replacing `INTEGER` by `NUMBER(11)`. INTEGER is equivalent to `NUMBER(38)`, which can store up to 38 digits. Hence, `NUMBER(11)` can store up to 11 digits.

While `VARCHAR` is an ANSI standard data type, it has not been fully implemented in Oracle and its use is discouraged. The `VARCHAR2` is Oracle's proprietary data type and it is the recommended type for variable-length character strings.

Oracle 12c introduced the `IDENTITY` column feature as a simpler alternative to the sequence/trigger combination for auto-incrementing columns. The syntax:

```sql
id NUMBER GENERATED BY DEFAULT AS IDENTITY
```

This is equivalent to MariaDB's:
```sql
id INTEGER AUTO_INCREMENT
```

Key benefits of using IDENTITY:
- Simpler syntax and maintenance
- No need for separate sequence objects
- No need for trigger definitions
- Automatically handles concurrent inserts
- Compatible with Oracle 12c and later versions

# Logs

Some relevant logs from the WMAgent 2.3.9.2 installation:
```
Start: Performing init_agent
init_agent: triggered.
Initializing WMAgent...
init_wmagent: MYSQL database: wmagent has been created
DEBUG:root:Log file ready
DEBUG:root:Using SQLAlchemy v.1.4.54
INFO:root:Instantiating base WM DBInterface
DEBUG:root:Tables for WMCore.WMBS created
DEBUG:root:Tables for WMCore.Agent.Database created
DEBUG:root:Tables for WMComponent.DBS3Buffer created
DEBUG:root:Tables for WMCore.BossAir created
DEBUG:root:Tables for WMCore.ResourceControl created
checking default database connection
default database connection tested
...
_sql_write_agentid: Preserving the current WMA_BUILD_ID and HostName at database: wmagent.
_sql_write_agentid: Creating wma_init table at database: wmagent
_sql_write_agentid: Inserting current Agent's build id and hostname at database: wmagent
_sql_dumpSchema: Dumping the current SQL schema of database: wmagent to /data/srv/wmagent/2.3.9/config/.wmaSchemaFile.sql
Done: Performing init_agent
```
